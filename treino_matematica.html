<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treino de Matem√°tica</title>
<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.card{
  background:white;
  padding:40px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  text-align:center;
  width:420px;
}
h1{ margin-bottom:10px; }
input[type="text"]{
  padding:8px;
  margin-bottom:15px;
  width:80%;
  font-size:16px;
  text-align:center;
}
button{
  padding:10px 20px;
  margin:8px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.primary{ background:#4CAF50; color:white; }
.secondary{ background:#2196F3; color:white; }
.outline{ background:#eee; }
.question{
  font-size:40px;
  margin:20px 0;
}
.answer-input{
  font-size:28px;
  text-align:center;
  width:120px;
  padding:5px;
}
</style>
</head>
<body>
<div class="card" id="app">
  <h1>Treino de Matem√°tica</h1>
  <div id="menu">
    <input type="text" id="playerName" placeholder="Nome do paciente" />
    <br>
    <button class="primary" onclick="startGame('soma')">Somas Iguais</button>
    <button class="secondary" onclick="startGame('dobro')">Dobros (x2)</button>
    <br>
    <button class="outline" onclick="exportCSVProtected()">Exportar Resultados</button>
  </div>
  <div id="game" style="display:none;">
    <div id="progress"></div>
    <div class="question" id="question"></div>
    <input type="number" class="answer-input" id="answer" autofocus onkeydown="if(event.key==='Enter'){submitAnswer()}">
  </div>
  <div id="result" style="display:none;"></div>
</div>

<script>

// üîê ALTERE A SENHA AQUI
const EXPORT_PASSWORD = "M3str3d4m4tem4tica"; 

let questions=[];
let current=0;
let errors=0;
let startTime;
let mode;
let player="";

function generateQuestions(type){
  const nums=[1,2,3,4,5,6,7,8,9];
  nums.sort(()=>Math.random()-0.5);
  return nums.map(n=>({
    question: type==='soma'? `${n} + ${n}` : `${n} x 2`,
    answer: type==='soma'? n+n : n*2
  }));
}

function startGame(selectedMode){
  player=document.getElementById('playerName').value.trim();
  if(player===""){
    alert("Digite o nome do paciente antes de come√ßar.");
    return;
  }

  mode=selectedMode;
  questions=generateQuestions(mode);
  current=0;
  errors=0;
  startTime=Date.now();
  document.getElementById('menu').style.display='none';
  document.getElementById('result').style.display='none';
  document.getElementById('game').style.display='block';
  showQuestion();
}

function showQuestion(){
  document.getElementById('progress').innerText=`${player} ‚Äî Quest√£o ${current+1} de 9`;
  document.getElementById('question').innerText=questions[current].question + " = ?";
  document.getElementById('answer').value='';
  document.getElementById('answer').focus();
}

function submitAnswer(){
  const input=parseInt(document.getElementById('answer').value);
  if(input!==questions[current].answer){ errors++; }
  current++;
  if(current<questions.length){
    showQuestion();
  } else {
    finishGame();
  }
}

function finishGame(){
  const totalTime=((Date.now()-startTime)/1000).toFixed(2);
  const avgTime=(totalTime/9).toFixed(2);
  const resultDiv=document.getElementById('result');
  resultDiv.innerHTML=`<h2>Resultado</h2>
    <p><strong>Paciente:</strong> ${player}</p>
    <p>Modo: ${mode}</p>
    <p>Tempo total: ${totalTime} segundos</p>
    <p>Tempo m√©dio: ${avgTime} segundos</p>
    <p>Erros: ${errors}</p>
    <button onclick="backToMenu()">Voltar</button>`;
  document.getElementById('game').style.display='none';
  resultDiv.style.display='block';
  saveResult(totalTime,avgTime);
}

function backToMenu(){
  document.getElementById('menu').style.display='block';
  document.getElementById('result').style.display='none';
}

function saveResult(totalTime,avgTime){
  const result={
    date:new Date().toLocaleString(),
    player:player,
    mode:mode,
    totalTime:totalTime,
    avgTime:avgTime,
    errors:errors
  };
  const stored=JSON.parse(localStorage.getItem('treinoResultados')||'[]');
  stored.push(result);
  localStorage.setItem('treinoResultados',JSON.stringify(stored));
}

function exportCSVProtected(){
  const senha=prompt("Digite a senha para exportar os resultados:");
  if(senha!==EXPORT_PASSWORD){
    alert("Senha incorreta.");
    return;
  }
  exportCSV();
}

function exportCSV(){
  const data=JSON.parse(localStorage.getItem('treinoResultados')||'[]');
  if(!data.length){ alert('Sem resultados ainda.'); return; }
  let csv="Data,Paciente,Modo,Tempo Total (s),Tempo M√©dio (s),Erros\n";
  data.forEach(r=>{
    csv+=`${r.date},${r.player},${r.mode},${r.totalTime},${r.avgTime},${r.errors}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='resultados_treino.csv';
  a.click();
}

</script>
</body>
</html>
